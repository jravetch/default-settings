#!/bin/sh

set -e

BT_BLOCK_PATH=/run/bluetooth.blocked

case "$2" in
    suspend | hybrid-sleep)
        case "$1" in
            pre)
                if rfkill -o ID,TYPE,SOFT | grep -q -E 'bluetooth\s+unblocked'; then
                    rfkill block bluetooth
                else
                    > "$BT_BLOCK_PATH"
                fi
                ;;
            post)
                [ ! -f "$BT_BLOCK_PATH" ] && rfkill unblock bluetooth
                rm "$BT_BLOCK_PATH" 2> /dev/null
                ;;
        esac
        ;;
esac
